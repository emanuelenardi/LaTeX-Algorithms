% Pretty Table of Contents
% https://tex.stackexchange.com/questions/35825/
% https://tex.stackexchange.com/a/51059/127473

% patching of \tableofcontents to use sans serif font for the tile
\usepackage{etoolbox}
\patchcmd{\tableofcontents}{\contentsname}{\sffamily\contentsname}{}{}

\usepackage{framed}
% this is the environment used to typeset the chapter entries in the ToC
% it is a modification of the leftbar environment of the framed package
\renewenvironment{leftbar}
{\def\FrameCommand{\hspace{6em}%
{\color{gray}\vrule width 2pt depth 6pt}\hspace{1em}}%
\MakeFramed{\parshape 1 0cm \dimexpr\textwidth-6em\relax\FrameRestore}\vskip2pt%
}
{\endMakeFramed}

\usepackage{titletoc}
% using titletoc we redefine the ToC entries for chapters, sections, and subsections
\titlecontents{chapter}
  [0em]{\vspace*{\baselineskip}}
  {%
    \begin{minipage}{\textwidth}
    \parbox{4.5em}{\hfill\Huge\sffamily\bfseries\color{darkgray}\thecontentspage}%
   \vspace{-1.5\baselineskip}\leftbar{\sffamily\chaptername~\thecontentslabel}\\
   \sffamily
  }
  {%
    \begin{minipage}{\textwidth}
    \parbox{4.5em}{%
    \hfill\Huge\sffamily\bfseries\color{darkgray}\thecontentspage}%
   \vspace{-1.5\baselineskip}\leftbar\textsf{}\\\sffamily}
  {\endleftbar\end{minipage}\nopagebreak}[\vskip2pt\nopagebreak]

\titlecontents{section}
  [8.4em]
  {\sffamily\contentslabel{3em}}{}{}
  {\hspace{0.5em}\nobreak\itshape\color{darkgray}\contentspage}

\titlecontents{subsection}
  [8.4em]
  {\sffamily\contentslabel{3em}}{}{}  
  {\hspace{0.5em}\nobreak\itshape\color{darkgray}\contentspage}

\titlecontents{subsubsection}
  [8.4em]
  {\sffamily\contentslabel{3em}}{}{}  
  {\hspace{0.5em}\nobreak\itshape\color{darkgray}\contentspage}